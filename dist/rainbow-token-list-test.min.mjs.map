{"version":3,"file":"rainbow-token-list-test.min.mjs","sources":["../src/constants.ts","../src/load.ts","../src/index.ts"],"sourcesContent":["import { z } from 'zod';\n\nexport const PRODUCTION = process.env.NODE_ENV === 'production';\n\nexport const CONTRACT_MAP_REPO = 'metamask/eth-contract-metadata';\n\nexport const ETHEREUM_LISTS_REPO = 'ethereum-lists/tokens/tokens/eth';\n\n//\n// Related to Token List and Token Overrides.\n//\nexport const REMOTE_TOKEN_LIST_ENDPOINT =\n  'https://raw.githubusercontent.com/ctjlewis/rainbow-token-list/service-compatibility/src/data/rainbow-token-list.json';\n\nexport const REMOTE_TOKEN_OVERRIDES_ENDPOINT =\n  'https://raw.githubusercontent.com/ctjlewis/rainbow-overrides/master/src/data/rainbow-overrides.json';\n\nexport const TokenListItemSchema = z.string().url().nonempty();\n\nexport type TokenListItem = z.infer<typeof TokenListItemSchema>;\nexport const TokenListTypeSchema = z.record(TokenListItemSchema);\nexport type TokenListType = z.infer<typeof TokenListTypeSchema>;\n\nexport const TOKEN_LISTS: TokenListType = {\n  aave: 'https://tokenlist.aave.eth.link',\n  coingecko: 'https://tokens.coingecko.com/uniswap/all.json',\n  dharma: 'https://tokenlist.dharma.eth.link',\n  kleros: 'http://t2crtokens.eth.link',\n  roll: 'https://app.tryroll.com/tokens.json',\n  synthetix: 'https://synths.snx.eth.link',\n  wrapped: 'http://wrapped.tokensoft.eth.link',\n};\n\nexport const TokenListEnumSchema = z.enum([\n  'aave',\n  'coingecko',\n  'dharma',\n  'kleros',\n  'roll',\n  'synthetix',\n  'wrapped',\n]);\nexport type TokenListEnum = z.infer<typeof TokenListEnumSchema>;\n\nexport const SocialSchema = z.object({\n  blog: z.string().optional(),\n  chat: z.string().optional(),\n  discord: z.string().optional(),\n  facebook: z.string().optional(),\n  forum: z.string().optional(),\n  github: z.string().optional(),\n  gitter: z.string().optional(),\n  instagram: z.string().optional(),\n  linkedin: z.string().optional(),\n  medium: z.string().optional(),\n  reddit: z.string().optional(),\n  slack: z.string().optional(),\n  telegram: z.string().optional(),\n  twitter: z.string().optional(),\n  youtube: z.string().optional(),\n});\n\nexport const TokenDeprecationSchema = z.object({\n  new_address: z.string().optional(),\n});\n\nexport const TokenExtensionsSchema = z.object({\n  color: z.string().optional(),\n  isRainbowCurated: z.boolean().optional(),\n  isVerified: z.boolean().optional(),\n  shadowColor: z.string().optional(),\n});\nexport type TokenExtensionsType = z.infer<typeof TokenExtensionsSchema>;\n\nexport const TokenSchema = z.object({\n  address: z.string().regex(/^0x[a-fA-F0-9]{40}$/),\n  chainId: z.number().optional(),\n  decimals: z.number().min(0),\n  deprecation: TokenDeprecationSchema.optional(),\n  extensions: TokenExtensionsSchema.optional(),\n  name: z.string(),\n  social: SocialSchema.optional(),\n  symbol: z.string(),\n  website: z.string().optional(),\n});\n\n/**\n * Raw token data that is loaded from the JSON files.\n */\nexport const RawContractMapTokenSchema = z.object({\n  address: z.string(),\n  decimals: z.union([z.string(), z.number()]),\n  name: z.string(),\n  symbol: z.string(),\n});\n\n/**\n * Raw token data that is loaded from the JSON files.\n */\nexport const RawEthereumListsTokenSchema = z.object({\n  address: z.string().optional(),\n  decimals: z.union([z.string(), z.number()]).optional(),\n  deprecation: TokenDeprecationSchema.optional(),\n  name: z.string().optional(),\n  social: SocialSchema.optional(),\n  symbol: z.string().optional(),\n  website: z.string().optional(),\n});\n\nexport type RawContractMapToken = z.infer<typeof RawContractMapTokenSchema>;\nexport type RawEthereumListsToken = z.infer<typeof RawEthereumListsTokenSchema>;\nexport type Token = z.infer<typeof TokenSchema>;\nexport type TokenSocialMetadata = z.infer<typeof SocialSchema>;\n","import { map, toLower } from 'lodash';\n\nimport OFFLINE_TOKEN_METADATA from './data/rainbow-token-list.json';\nimport { OFFLINE_TOKEN_OVERRIDES } from 'rainbow-overrides';\n\nimport {\n  REMOTE_TOKEN_LIST_ENDPOINT,\n  REMOTE_TOKEN_OVERRIDES_ENDPOINT,\n} from './constants';\nimport fetch from 'node-fetch';\n\ntype TokenMetadata = typeof OFFLINE_TOKEN_METADATA;\n\n/**\n * Get the raw Token List data.\n *\n * @param endpoint The endpoint from which to load the Token List.\n * @param offlineData The data to fallback to in case of network failure.\n * @returns The Token List dataset.\n */\nexport const loadFromEndpoint = async <T>(endpoint: string, offlineData: T) => {\n  console.log('Making request to', endpoint);\n  try {\n    const result = await fetch(endpoint);\n    console.log('REQUEST SUCCEEDED.');\n    return await result.json();\n  } catch (e) {\n    console.log('REQUEST FAILED.', e);\n    return offlineData;\n  }\n};\n\n/**\n * Load the full Token List, including any manual tokens.\n *\n * @param offlineData The data to fallback to in case of network failure.\n * @returns The full Token List.\n */\nexport const loadTokenList = async () => {\n  const tokenData = await loadFromEndpoint(\n    REMOTE_TOKEN_LIST_ENDPOINT,\n    OFFLINE_TOKEN_METADATA\n  );\n\n  const tokens = await tokenListFromData(tokenData);\n  return tokens;\n};\n\n/**\n * Load the Token Overrides List.\n * @returns All token overrides.\n */\nexport const loadTokenOverrides = async (): Promise<any> => {\n  const overrides = loadFromEndpoint(\n    REMOTE_TOKEN_OVERRIDES_ENDPOINT,\n    OFFLINE_TOKEN_OVERRIDES\n  );\n\n  return overrides;\n};\n\n/**\n * Get the Token List from raw metadata.\n *\n * @param tokenData The raw Token List data to process.\n * @returns The Token List.\n */\nexport const tokenListFromData = async (tokenData: TokenMetadata) => {\n  const loadedTokens = map(tokenData.tokens, (token) => {\n    const { address: rawAddress, decimals, name, symbol, extensions } = token;\n    const address = toLower(rawAddress);\n\n    return {\n      address,\n      decimals,\n      name,\n      symbol,\n      uniqueId: address,\n      ...extensions,\n    };\n  });\n\n  return loadedTokens;\n};\n","#!/usr/bin/env node\n\n/**\n * Disable certificate validation.\n *\n * @see https://nodejs.org/api/cli.html#cli_node_tls_reject_unauthorized_value\n */\n/**\n * Library imports and exports.\n */\nprocess.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';\n\nexport * from './load';\n"],"names":["process","TokenListItemSchema","z","string","url","nonempty","record","enum","SocialSchema","object","blog","optional","chat","discord","facebook","forum","github","gitter","instagram","linkedin","medium","reddit","slack","telegram","twitter","youtube","TokenDeprecationSchema","new_address","TokenExtensionsSchema","color","isRainbowCurated","boolean","isVerified","shadowColor","address","regex","chainId","number","decimals","min","deprecation","extensions","name","social","symbol","website","union","loadFromEndpoint","async","endpoint","offlineData","console","log","result","fetch","json","e","loadTokenList","tokenData","OFFLINE_TOKEN_METADATA","tokenListFromData","loadTokenOverrides","OFFLINE_TOKEN_OVERRIDES","map","tokens","token","rawAddress","toLower","uniqueId","env","NODE_TLS_REJECT_UNAUTHORIZED"],"mappings":"m93rBAE0BA,QASnB,MAMMC,EAAsBC,EAAEC,SAASC,MAAMC,WAGjBH,EAAEI,OAAOL,GAaTC,EAAEK,KAAK,CACxC,OACA,YACA,SACA,SACA,OACA,YACA,YAIK,MAAMC,EAAeN,EAAEO,OAAO,CACnCC,KAAMR,EAAEC,SAASQ,WACjBC,KAAMV,EAAEC,SAASQ,WACjBE,QAASX,EAAEC,SAASQ,WACpBG,SAAUZ,EAAEC,SAASQ,WACrBI,MAAOb,EAAEC,SAASQ,WAClBK,OAAQd,EAAEC,SAASQ,WACnBM,OAAQf,EAAEC,SAASQ,WACnBO,UAAWhB,EAAEC,SAASQ,WACtBQ,SAAUjB,EAAEC,SAASQ,WACrBS,OAAQlB,EAAEC,SAASQ,WACnBU,OAAQnB,EAAEC,SAASQ,WACnBW,MAAOpB,EAAEC,SAASQ,WAClBY,SAAUrB,EAAEC,SAASQ,WACrBa,QAAStB,EAAEC,SAASQ,WACpBc,QAASvB,EAAEC,SAASQ,aAGTe,EAAyBxB,EAAEO,OAAO,CAC7CkB,YAAazB,EAAEC,SAASQ,aAGbiB,EAAwB1B,EAAEO,OAAO,CAC5CoB,MAAO3B,EAAEC,SAASQ,WAClBmB,iBAAkB5B,EAAE6B,UAAUpB,WAC9BqB,WAAY9B,EAAE6B,UAAUpB,WACxBsB,YAAa/B,EAAEC,SAASQ,aAICT,EAAEO,OAAO,CAClCyB,QAAShC,EAAEC,SAASgC,MAAM,uBAC1BC,QAASlC,EAAEmC,SAAS1B,WACpB2B,SAAUpC,EAAEmC,SAASE,IAAI,GACzBC,YAAad,EAAuBf,WACpC8B,WAAYb,EAAsBjB,WAClC+B,KAAMxC,EAAEC,SACRwC,OAAQnC,EAAaG,WACrBiC,OAAQ1C,EAAEC,SACV0C,QAAS3C,EAAEC,SAASQ,aAMmBT,EAAEO,OAAO,CAChDyB,QAAShC,EAAEC,SACXmC,SAAUpC,EAAE4C,MAAM,CAAC5C,EAAEC,SAAUD,EAAEmC,WACjCK,KAAMxC,EAAEC,SACRyC,OAAQ1C,EAAEC,WAM+BD,EAAEO,OAAO,CAClDyB,QAAShC,EAAEC,SAASQ,WACpB2B,SAAUpC,EAAE4C,MAAM,CAAC5C,EAAEC,SAAUD,EAAEmC,WAAW1B,WAC5C6B,YAAad,EAAuBf,WACpC+B,KAAMxC,EAAEC,SAASQ,WACjBgC,OAAQnC,EAAaG,WACrBiC,OAAQ1C,EAAEC,SAASQ,WACnBkC,QAAS3C,EAAEC,SAASQ,mBCtFToC,EAAmBC,MAAUC,EAAkBC,KAC1DC,QAAQC,IAAI,oBAAqBH,GACjC,IACE,MAAMI,QAAeC,EAAML,GAE3B,OADAE,QAAQC,IAAI,4BACCC,EAAOE,OACpB,MAAOC,GAEP,OADAL,QAAQC,IAAI,kBAAmBI,GACxBN,IAUEO,EAAgBT,UAC3B,MAAMU,QAAkBX,ED3BxB,uHC6BEY,GAIF,aADqBC,EAAkBF,IAQ5BG,EAAqBb,SACdD,EDtClB,sGCwCEe,GAYSF,EAAoBZ,MAAOU,GACjBK,EAAIL,EAAUM,QAASC,IAC1C,MAAQ/B,QAASgC,EAAU5B,SAAEA,EAAQI,KAAEA,EAAIE,OAAEA,EAAMH,WAAEA,GAAewB,EAC9D/B,EAAUiC,EAAQD,GAExB,MAAO,CACLhC,QAAAA,EACAI,SAAAA,EACAI,KAAAA,EACAE,OAAAA,EACAwB,SAAUlC,KACPO,MCpETzC,QAAQqE,IAAIC,6BAA+B"}